<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Signaturendruck</title>
        <style type="text/css"> 
            #filecontents, #tableBox { 
                border:double; 
                overflow-y:scroll; 
                height:100px; 
            }
            .toPrint {
                width: 50px;
                height: 50px;
                padding: 0px;
                margin: 0px;
            }
        </style>
    </head>
    <body>
        <p>Die Signaturen stammen aus: <span id="defaultPath"></span></p>
        <p>Eine andere Datei ausw√§hlen: 
            <input type="file" id="fileToRead" />
        </p>
        <div id="tableBox">
            <table id="signaturTable">
                <tr>
                    <!-- <th onclick="sortTable(0)">Signatur</th>
                    <th onclick="sortTable(1)">Bearbeitet am</th>
                    <th onclick="sortTable(2)">Exemplar</th> -->
                    <th>Signatur</th>
                    <th>Bearbeitet am</th>
                    <th>Exemplar</th>
                    <th>Kurze Signatur</th>
                    <th>Drucken</th>
                    <th>Anzahl</th>
                </tr>
            </table>
        </div>
        <div>Folgende verwertbare Informationen sind enthalten:</div> 
        <div id="filecontents">
        </div>
        <div>
            <button onclick="createPDF()">klick mich</button>
            <button onclick="changeStyle()">mich auch</button>
            <button onclick="loadData()">lade Daten</button>
            <button onclick="vorschau(2)">Vorschau</button>
        </div>
        <div id="testBox">
            <div id="toPDF">
                <div>Test</div>
                <div class="html2pdf__page-break"></div>
                <div class="toPrint" id="capture" style="background: #f5da55">
                    <h4 style="color: #000; margin: 0px">Hello world!</h4>
                </div>
                <div class="html2pdf__page-break"></div>
                <div class="toPrint" style="background: #f5da55">
                    <h4 style="color: #000; margin: 0px">Hello world!</h4>
                </div>
                <div class="html2pdf__page-break"></div>
                <div class="toPrint" style="background: #f5da55">
                    <h4 style="color: #000; margin: 0px">Hello world!</h4>
                </div>
                <div class="html2pdf__page-break"></div>
                <div class="toPrint" style="background: #f5da55">
                    <h4 style="color: #000; margin: 0px">Hello world!</h4>
                </div>
                <div class="html2pdf__page-break"></div>
                <div class="toPrint" style=" background: #f5da55">
                    <h4 style="color: #000; margin: 0px">Hello world!</h4>
                </div>
                <div class="html2pdf__page-break"></div>
                <div class="toPrint" style="background: #f5da55">
                    <h4 style="color: #000; margin: 0px">Hello world!</h4>
                </div>
            </div>
        </div>
        <script>
        // You can also require other files to run in this process
            require('./renderer.js')
            const html2canvas = require("html2canvas")
            const jsPDF = require("jspdf");
            const html2pdf = require("html2pdf.js")
            const fs = require("fs");
            const _ = require("lodash");
            const Store = require("electron-store");
            const store = new Store();
        </script>
        <script src="./sortTable.js"></script>
        <script>
            function changeStyle() {
                let newConfig = loadConfig();
                console.log(newConfig);
                var toPrint = document.getElementsByClassName("toPrint");
                var width;
                var height;
                console.log(toPrint);
                width = newConfig.gross.label.width;
                height = newConfig.gross.label.height;
                console.log(width, height);
                for (let i = 0; i < toPrint.length; i++) {
                    toPrint[i].style.width = '' + width + 'px';
                    toPrint[i].style.height = '' + height + 'px';
                    // toPrint[i].style.margin = '50px';'
                }
            console.log(toPrint);
            }
            function createPDF() {
                // html2canvas(document.querySelector("#capture")).then(canvas => {
                //     document.body.appendChild(canvas);
                // });
                changeStyle();
                let newConfig = loadConfig();
                var element = document.getElementById("toPDF");
                html2pdf(element, {
                    margin:       1,
                    filename:     'myfile.pdf',
                    image:        { type: 'png', quality: 0.99 },
                    html2canvas:  { dpi: 192, letterRendering: true },
                    jsPDF:        { unit: 'px', format: [newConfig.gross.label.width + 3, newConfig.gross.label.height + 3], orientation: 'portrait' }
                });
            }
            function loadConfig() {
                return store.store;
            }
        </script>
        <script>
            function loadData() {
                fs.readFile("signaturen.json", "utf8", function readFileCallback(err, data){
                    if (err){
                        console.log(err);
                    } else {
                        output(JSON.parse(data));
                        console.log("signaturen.json wurde gelesen");
                    }
                });
            }
            function output(obj) {
                var table = document.getElementById("signaturTable");
                var i = 1;
                _.forEach(obj, function(key, value){
                    var row = table.insertRow(i);
                    var ppnRow = row.insertCell(0);
                    ppnRow.innerHTML = value;
                    _.forEach(key, function(objct){
                        i++;
                        row = table.insertRow(i);
                        var txtCell = row.insertCell(0);
                        var dateCell = row.insertCell(1);
                        var exnrCell = row.insertCell(2);
                        _.forEach(objct.txt, function(value){
                            txtCell.innerHTML += value + " ";
                        });
                        dateCell.innerHTML = objct.date;
                        exnrCell.innerHTML = objct.exNr;
                    });
                    i++;
                });
            }
        </script>
        <script>
            function vorschau(id) {
                fs.readFile("signaturen.json", "utf8", function readFileCallback(err, data){
                    if (err){
                        console.log(err);
                    } else {
                        let sig = "";
                        _.forEach(JSON.parse(data), function(key, value){
                            let found = _.find(key, {"id": id});
                            if (found !== undefined) {
                                sig = found;
                            }
                        });
                        if (sig != "") {
                            console.log(sig);
                        }
                    }
                });
            }
        </script>
    </body>
</html>
