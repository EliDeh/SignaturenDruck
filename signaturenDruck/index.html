<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Signaturendruck</title>
        <style type="text/css"> 
            #filecontents, #tableBox { 
                border:double; 
                overflow-y:scroll; 
                height:200px; 
            }
            .toPrint {
                width: 50px;
                height: 50px;
                padding: 0px;
                margin: 0px;
            }
            #buttonBox > button {
                width: 180px;
                height: 20px;
                margin: 5px 10px 5px 10px;
                text-align: center;
            }
            #container {
                border: double;
                overflow: hidden;
            }
            #buttonBox {
                float:left; /* add this */
                border: 1px solid red;
            }
            #previewBox {
                width: 80mm;
                height: 43mm;
                border: 1px solid green;
                float: right; /* add this */
            }
            th {
                text-align: center;
            }
        </style>
    </head>
    <body>
        <p>Die Signaturen stammen aus: <span id="defaultPath"></span></p>
        <p>Eine andere Datei auswählen: 
            <input type="file" id="fileToRead" />
        </p>
        <div id="tableBox">
            <table id="signaturTable">
                <tr>
                    <!-- <th onclick="sortTable(0)">Signatur</th>
                    <th onclick="sortTable(1)">Bearbeitet am</th>
                    <th onclick="sortTable(2)">Exemplar</th> -->
                    <th style="width: 35%">Signatur</th>
                    <th style="width: 20%">Bearbeitet am</th>
                    <th style="width: 15%">Exemplar</th>
                    <th style="width: 5%">Kurze Signatur</th>
                    <th style="width: 5%">Drucken</th>
                    <th style="width: 15%">Anzahl</th>
                    <th style="width: 5%">Größe</th>
                </tr>
            </table>
        </div>
        <div id="container">
            <div id="buttonBox">
                <button id="btn_">Manuelles Anlegen</button><br>
                <button id="btn_deleteFile">Lösche Download Datei</button><br>
                <button id="btn_deleteList">Liste löschen</button><br>
                <button id="btn_loadData">loadData</button><br>
                <button id="btn_print" onclick="printButton()">Drucken</button><br>
                <button id="btn_close">Beenden</button>
            </div>
            <div id="previewBox" style="background: #00f8d7"></div>
        </div>
        <script>
        // You can also require other files to run in this process
            require('./renderer.js')
            // required for pdf creation
            const html2canvas = require("html2canvas")
            const jsPDF = require("jspdf");
            const html2pdf = require("html2pdf.js")
            // required for file stuff
            const fs = require("fs");
            // requires lodash
            const _ = require("lodash");
            // required for persistent config
            const store = require("electron-store");
            const config = new store();
            // required for ipc calls to the main process
            const ipc = require("electron").ipcRenderer;
        </script>
        <script src="./sortTable.js"></script>
        <script>
            function changeStyle() {
                let newConfig = loadConfig();
                console.log(newConfig);
                let toPrint = document.getElementsByClassName("toPrint");
                let width = newConfig.big.label.width;;
                let height = newConfig.big.label.height;;
                let unit = newConfig.einheit;;
                console.log(toPrint);
                width = newConfig.big.label.width;
                height = newConfig.big.label.height;
                console.log(width, height);
                for (let i = 0; i < toPrint.length; i++) {
                    toPrint[i].style.width = '' + width + unit;
                    toPrint[i].style.height = '' + height + unit;
                    // toPrint[i].style.margin = '50px';'
                }
            console.log(toPrint);
            }
        </script>
        <script>
            function preview(id) {
                let file = fs.readFileSync("signaturen.json", "utf8");
                let sig = "";
                _.forEach(JSON.parse(file), function(key, value){
                    let found = _.find(key, {"id": id});
                    if (found !== undefined) {
                        sig = found;
                    }
                });
                if (sig != "") {
                    console.log(sig);
                    let length = sig.txtLength;
                    let i = 1;
                    let line = document.createElement('p');
                    console.log(length);
                    if (length > 3) {
                        console.log("added stuff");
                    } else {

                    }
                    let myNode = document.getElementById("previewBox");
                    while (myNode.firstChild) {
                        myNode.removeChild(myNode.firstChild);
                    }
                    sig.txt.forEach(element => {
                        line.className = "previewLine";
                        line.id = "line" + i;
                        if (element == "") {
                            let emptyLine = document.createElement("br");
                        line.appendChild(emptyLine);
                        } else {
                            line.innerHTML = element;
                        }
                        document.getElementById("previewBox").appendChild(line);
                        line = document.createElement('p');
                        i++;
                    });
                }
            }
        </script>
        <script>
            function printButton() {
                let dataAll = {};
                let j = 0;
                
                let elems= document.querySelectorAll("[name=toPrint]");
                for (let i=0;i<elems.length;i++)
                {
                    if (elems[i].checked) {
                        let data = {
                            "id": "",
                            "count": "1",
                            "size": "big",
                            "short": false
                        };
                        data.id = elems[i].value;
                        let count = document.getElementById("count_"+data.id).value;
                        if ((count <= 99) && (count >= 1)) {
                            data.count = count;
                        }
                        if (document.getElementById("short_"+data.id)){
                            if (document.getElementById("short_"+data.id).checked) {
                                data.short = true;
                            }
                            data.size = "small";
                        }
                        dataAll[j] = data;
                        console.log(data);
                        j++;
                    }
                }
                // data.toPrint.forEach(element => {
                //     console.log(document.getElementById("count_"+element).value);
                //     data.count.push(document.getElementById("count_"+element).value);
                //     if (document.getElementById("short_"+element)) {
                //         if (document.getElementById("short_"+element).checked) {
                //             data.short.push(element);
                //         }
                //     }
                // });
                console.log("checked ", dataAll);
                ipc.send("print", dataAll);
            }
        </script>
    </body>
</html>
